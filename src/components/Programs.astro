---
const programs = [
    {
        title: "Pack Calma y Sue√±o",
        target: "Estr√©s y Ansiedad",
        desc: "Masaje anti-estr√©s para regular el sue√±o, liberar tensi√≥n acumulada y mejorar el √°nimo. Pack de 5 sesiones.",
        price: "$25.000 / sesi√≥n",
        icon: "üåô",
        featured: false,
    },
    {
        title: "Rehab. Dolor Cr√≥nico",
        target: "Recuperaci√≥n Funcional",
        desc: "Alivio del dolor, entrenamiento de fuerza y elongaci√≥n. Packs de 5 y 10 sesiones (2-3 veces por semana).",
        price: "$25.000 / sesi√≥n",
        icon: "‚ö°",
        featured: true,
    },
    {
        title: "Retorno Seguro",
        target: "Pre y Post Operatorio",
        desc: "Rehabilitaci√≥n de fracturas, esguinces y preparaci√≥n para cirug√≠a (control presi√≥n, glicemia, fuerza).",
        price: "$25.000 / sesi√≥n",
        icon: "üõ°Ô∏è",
        featured: false,
    },
    {
        title: "Alivio Express",
        target: "Dolor Agudo",
        desc: "Soluci√≥n inmediata para contracturas, bruxismo, lumbago, cervicalgia o dolor de rodilla. 1 sesi√≥n.",
        price: "$30.000",
        icon: "üöë",
        featured: false,
    },
    {
        title: "Envejecimiento Activo",
        target: "Adulto Mayor",
        desc: "Entrenamiento de fuerza, coordinaci√≥n y equilibrio. Prevenci√≥n de ca√≠das y mejora de independencia.",
        price: "$25.000 / sesi√≥n",
        icon: "üå≥",
        featured: false,
    },
    {
        title: "Pack Respiratorio",
        target: "Ni√±os y Adultos",
        desc: "Drenaje bronquial, aseo nasal y entrenamiento respiratorio. Evita urgencias y virus.",
        price: "$30.000 / sesi√≥n",
        icon: "ü´Å",
        featured: false,
    },
];
---

<section id="programas" class="programs-section">
    <!-- Ambient Light Background -->
    <div class="ambient-light"></div>
    <div class="ambient-light-2"></div>

    <div class="container mobile-container">
        <div class="section-header">
            <h2 class="section-title">Programas de Transformaci√≥n</h2>
            <p class="section-subtitle">
                Soluciones dise√±adas para recuperar tu bienestar integral
            </p>
        </div>

        <div class="carousel-wrapper">
            <button class="nav-btn prev-btn" aria-label="Ver anteriores">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="m15 18-6-6 6-6"></path></svg
                >
            </button>

            <div class="programs-carousel" id="programsCarousel">
                {
                    programs.map((prog) => (
                        <div
                            class={`program-card ${prog.featured ? "featured" : ""}`}
                        >
                            <div class="card-content-inner">
                                <div class="card-icon-wrapper">
                                    <span class="card-icon">{prog.icon}</span>
                                </div>
                                <h3 class="card-title">{prog.title}</h3>
                                <div class="card-target">{prog.target}</div>
                                <p class="card-desc">{prog.desc}</p>
                                <div class="card-footer">
                                    <div class="card-price">{prog.price}</div>
                                    <a
                                        href="#contacto"
                                        class={`btn-card ${prog.featured ? "btn-featured" : ""}`}
                                    >
                                        Agendar
                                    </a>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>

            <button class="nav-btn next-btn" aria-label="Ver siguientes">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg
                >
            </button>
        </div>

        <div class="cta-bar fade-in-up">
            <div class="cta-content">
                <span class="cta-icon">üè†</span>
                <div class="cta-text">
                    <h3>¬øQuieres una sesi√≥n de Prueba?</h3>
                    <p>
                        Agenda tu <strong>primera evaluaci√≥n a domicilio</strong
                        > por solo <strong>$15.000</strong>.
                    </p>
                </div>
            </div>
            <a href="#contacto" class="btn-cta">Probar por $15.000</a>
        </div>
    </div>
</section>

<style>
    .programs-section {
        padding: 120px 0;
        position: relative;
        overflow: hidden;
        background: #0b1120;
    }

    /* Ambient Light Effects */
    .ambient-light,
    .ambient-light-2 {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        z-index: 0;
        pointer-events: none;
        animation: floatLight 10s infinite alternate ease-in-out;
    }

    .ambient-light {
        top: -10%;
        left: -10%;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, var(--color-primary), transparent);
    }

    .ambient-light-2 {
        bottom: -10%;
        right: -10%;
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, #0f4c75, transparent);
        animation-delay: -5s;
    }

    @keyframes floatLight {
        0% {
            transform: translate(0, 0);
        }
        100% {
            transform: translate(50px, 50px);
        }
    }

    .container {
        position: relative;
        z-index: 1;
        max-width: 1400px; /* Wider container for 3 cards */
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .section-header {
        text-align: center;
        margin-bottom: 4rem;
        padding: 0 1.5rem;
    }

    .section-title {
        font-size: 3rem;
        margin-bottom: 1rem;
        background: linear-gradient(to right, #fff, #a5f3fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
        letter-spacing: -1px;
    }

    .section-subtitle {
        font-size: 1.25rem;
        color: #94a3b8;
        max-width: 600px;
        margin: 0 auto;
    }

    /* Carousel Wrapper */
    .carousel-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        margin-bottom: 6rem;
        width: 100%;
    }

    .programs-carousel {
        display: flex;
        gap: 24px; /* Fixed gap */
        overflow-x: auto;
        padding: 2rem 1rem 4rem 1rem;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        scrollbar-width: none;
        -ms-overflow-style: none;
        width: 100%;
        /* Align items to stretch to ensure same height */
        align-items: stretch;
    }

    .programs-carousel::-webkit-scrollbar {
        display: none;
    }

    /* Navigation Buttons */
    .nav-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
        flex-shrink: 0;
        /* Absolute positioning for cleaner layout */
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
    }

    .prev-btn {
        left: -20px;
    }
    .next-btn {
        right: -20px;
    }

    .nav-btn:hover {
        background: var(--color-primary);
        color: #0b1120;
        border-color: var(--color-primary);
        box-shadow: 0 0 20px rgba(87, 226, 229, 0.4);
    }

    /* Cards */
    .program-card {
        /* 
           Desktop: 3 cards visible minus gaps. 
           Gap is 24px. 3 cards means 2 gaps = 48px total gap.
           Basis = calc((100% - 48px) / 3) 
        */
        flex: 0 0 calc((100% - 48px) / 3);
        scroll-snap-align: start;
        position: relative;
        display: flex; /* Make card a flex container */
    }

    .card-content-inner {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 2.5rem;
        border-radius: 24px;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%; /* Fill the wrapper height */
    }

    .program-card:hover .card-content-inner {
        transform: translateY(-10px);
        border-color: rgba(87, 226, 229, 0.3);
        background: rgba(30, 41, 59, 0.6);
        box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.5);
    }

    .featured .card-content-inner {
        background: linear-gradient(
            145deg,
            rgba(87, 226, 229, 0.05),
            rgba(15, 76, 117, 0.2)
        );
        border: 1px solid rgba(87, 226, 229, 0.3);
        box-shadow: 0 0 30px rgba(87, 226, 229, 0.1);
    }

    .card-icon-wrapper {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.5rem;
        font-size: 2rem;
        transition: transform 0.3s ease;
    }

    .program-card:hover .card-icon-wrapper {
        transform: scale(1.1) rotate(5deg);
        background: rgba(87, 226, 229, 0.1);
    }

    .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #fff;
        line-height: 1.2;
    }

    .card-target {
        font-size: 0.8rem;
        color: var(--color-primary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 700;
        margin-bottom: 1.5rem;
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: rgba(87, 226, 229, 0.08);
        border-radius: 100px;
    }

    .card-desc {
        font-size: 1rem;
        color: #cbd5e1;
        margin-bottom: 2rem;
        flex-grow: 1; /* Pushes footer down */
        line-height: 1.6;
    }

    .card-footer {
        margin-top: auto;
    }

    .card-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 1rem;
        display: block;
    }

    .btn-card {
        display: block;
        width: 100%;
        text-align: center;
        padding: 1rem 0;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 1px solid transparent;
    }

    .btn-card:hover {
        background: #fff;
        color: #0b1120;
        border-color: #fff;
    }

    .btn-featured {
        background: var(--color-primary);
        color: #0b1120;
        box-shadow: 0 4px 15px rgba(87, 226, 229, 0.3);
    }

    .btn-featured:hover {
        background: #fff;
        color: #0b1120;
    }

    /* CTA Bar */
    .cta-bar {
        background: linear-gradient(135deg, #1e293b, #0f172a);
        border-radius: 24px;
        padding: 3rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
        position: relative;
        overflow: hidden;
    }

    .cta-bar::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 10% 50%,
            rgba(87, 226, 229, 0.1),
            transparent 50%
        );
        pointer-events: none;
    }

    .cta-content {
        display: flex;
        align-items: center;
        gap: 2rem;
        position: relative;
        z-index: 1;
    }

    .cta-icon {
        font-size: 3.5rem;
    }

    .cta-text h3 {
        font-size: 1.75rem;
        color: #fff;
        margin-bottom: 0.5rem;
        font-weight: 700;
    }

    .cta-text p {
        color: #cbd5e1;
        font-size: 1.15rem;
    }

    .btn-cta {
        background: linear-gradient(90deg, #fff, #e2e8f0);
        color: #0f172a;
        padding: 1.25rem 2.5rem;
        border-radius: 100px;
        font-weight: 800;
        text-decoration: none;
        transition: all 0.3s ease;
        white-space: nowrap;
        box-shadow: 0 5px 20px rgba(255, 255, 255, 0.15);
        position: relative;
        z-index: 1;
    }

    .btn-cta:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(255, 255, 255, 0.25);
    }

    @media (max-width: 1024px) {
        .program-card {
            /* Tablet: 2 cards visible. Gap 24px. 1 gap = 24px. */
            flex: 0 0 calc((100% - 24px) / 2);
        }
        .nav-btn {
            display: none;
        } /* Usually hide arrows on touch */
    }

    @media (max-width: 900px) {
        .programs-section {
            padding: 80px 0;
        }

        .program-card {
            /* Mobile: 1 card visible (full width close to 100%) or peek */
            flex: 0 0 85%;
        }

        .programs-carousel {
            padding: 2rem 1.5rem 3rem 1.5rem;
        }

        .cta-bar {
            flex-direction: column;
            text-align: center;
            padding: 2.5rem 1.5rem;
            gap: 2rem;
            margin-top: 2rem; /* Spacing */
        }

        .cta-content {
            flex-direction: column;
            gap: 1rem;
        }
        .btn-cta {
            width: 100%;
            text-align: center;
        }
        .section-title {
            font-size: 2.25rem;
        }

        .nav-btn {
            display: none;
        }
    }
</style>

<script>
    import gsap from "gsap";
    import ScrollTrigger from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    // Initial load animation
    gsap.from(".program-card", {
        scrollTrigger: {
            trigger: ".programs-carousel",
            start: "top 85%",
        },
        y: 60,
        opacity: 0,
        duration: 0.8,
        stagger: 0.1,
        ease: "power2.out",
    });

    gsap.from(".cta-bar", {
        scrollTrigger: {
            trigger: ".cta-bar",
            start: "top 90%",
        },
        y: 50,
        opacity: 0,
        duration: 1,
        ease: "power3.out",
    });

    // Carousel Navigation Logic
    const carousel = document.getElementById("programsCarousel");
    const prevBtn = document.querySelector(".prev-btn");
    const nextBtn = document.querySelector(".next-btn");

    // We update this on resize to ensure functionality
    function scrollCarousel(direction: string) {
        if (!carousel) return;

        // Calculate scroll amount: visible width of container (roughly 3 cards)
        // Or better: scroll by one card width including gap
        // Desktop: (100% - 48px)/3 + 24px gap

        const style = window.getComputedStyle(carousel);
        const gap = parseFloat(style.gap) || 24;

        // Find visible item width
        const item = carousel.querySelector(".program-card");
        if (!item) return;

        const itemWidth = item.getBoundingClientRect().width;
        const scrollAmount = (itemWidth + gap) * 1; // Scroll 1 card at a time for smoother nav

        if (direction === "next") {
            carousel.scrollBy({ left: scrollAmount, behavior: "smooth" });
        } else {
            carousel.scrollBy({ left: -scrollAmount, behavior: "smooth" });
        }
    }

    if (carousel && prevBtn && nextBtn) {
        prevBtn.addEventListener("click", () => scrollCarousel("prev"));
        nextBtn.addEventListener("click", () => scrollCarousel("next"));
    }
</script>
